const rp = require('request-promise');
const cheerio = require('cheerio');

exports.getStats = async (player) => {

    if (typeof player !== "string") throw new TypeError("Player must be a string.");
    let options = {
        url: `https://www.realmeye.com/player/${player}`,
        headers: {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36'
        }
    }
        const html = await rp(options);
        var $ = cheerio.load(html);

        if($(`.col-md-12 h2`).text() == "Sorry, but we either:"){
            console.log(`No user exists under that name.`)
            return
        }
        else{
            var userObj = {};

            try{
                userObj.name = $(`span.entity-name`).text().replace(/\n?\t/g, '');
                //userObj.fame      = $(`.summary .numeric`).text()
                userObj.line1     = $(`.well.description .line1.description-line`).text()
                userObj.line2     = $(`.well.description .line2.description-line`).text()
                userObj.line3     = $(`.well.description .line3.description-line`).text()
                /*userObj.level     = $(`span.Level`).text();
                userObj.avatarURL = "http://" + $(`div.ProfileIcon > img`)[0].attribs.src.substring(2);
                userObj.rank      = $(`.TierRank`).text().replace(/\n?\t/g, '');
                userObj.KDARatio  = $(`.GameAverageStats .KDA .KDARatio .KDARatio`).text().replace(/\n?\t/g, '');
*/
                return userObj;
            }
            catch(err){
                console.log(err)
            }
        }
}